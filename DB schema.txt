CREATE TABLE account (
  id UUID PRIMARY KEY,
  currency VARCHAR(3),
  status VARCHAR(20)
);

CREATE TABLE ledger_entry (
  id UUID PRIMARY KEY,
  account_id UUID,
  transfer_id UUID,
  amount NUMERIC(18,2),
  created_at TIMESTAMP,
  UNIQUE (transfer_id, account_id)
);

CREATE TABLE idempotency_key (
  id UUID PRIMARY KEY,
  created_at TIMESTAMP
);

CREATE INDEX idx_ledger_account ON ledger_entry(account_id);

ALTER TABLE account
ADD COLUMN client_id UUID NOT NULL;

CREATE INDEX idx_account_client_id
ON account(client_id);