docker run -d --name kafka -p 9092:9092 apache/kafka:latest

docker run -d ^
  --name kafka ^
  -p 9092:9092 ^
  -e KAFKA_PROCESS_ROLES=broker,controller ^
  -e KAFKA_NODE_ID=1 ^
  -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 ^
  -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://host.docker.internal:9092 ^
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT ^
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER ^
  -e KAFKA_CONTROLLER_QUORUM_VOTERS=1@localhost:9093 ^
  apache/kafka:latest

docker exec kafka /opt/kafka/bin/kafka-topics.sh ^
  --bootstrap-server host.docker.internal:9092 ^
  --create ^
  --topic transfer.completed ^
  --partitions 3 ^
  --replication-factor 1
  
CREATE TABLE processed_event (
    event_id VARCHAR(64) PRIMARY KEY,
    processed_at TIMESTAMP NOT NULL
);

CREATE TABLE account_view (
    account_id     VARCHAR(64)  NOT NULL,
    client_id      VARCHAR(64)  NOT NULL,
    balance        NUMERIC(19, 4) NOT NULL,
    currency       VARCHAR(3)      NOT NULL,
    last_updated   TIMESTAMP    NOT NULL,
    CONSTRAINT pk_account_view PRIMARY KEY (account_id)
);
